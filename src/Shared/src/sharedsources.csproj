<!-- this is a dummy project designed to produce contentFiles packages -->
<Project InitialTargets="VerifyProperties">
  <Import Project="Directory.Build.props" />

  <PropertyGroup>
    <PackageDependsOn>$(PackageDependsOn);PackSharedSources</PackageDependsOn>
    <GetArtifactInfoDependsOn>$(GetArtifactInfoDependsOn);ResolveSharedSourcesPackageInfo</GetArtifactInfoDependsOn>
  </PropertyGroup>

  <Import Project="Sdk.props" Sdk="Microsoft.NET.Sdk" />

  <Target Name="PackSharedSources" DependsOnTargets="_GetSharedSourcesProjects">
    <MSBuild Targets="Restore;Pack"
      Projects="@(_SharedSourceProj)"
      Properties="$(BuildProperties)"
      Condition="@(_SharedSourceProj->Count()) != 0"
      BuildInParallel="true" />
  </Target>

  <Target Name="_GetSharedSourcesProjects">
    <PropertyGroup>
      <_SharedSourcesPackageProperties>
        RepositoryRoot=$(RepositoryRoot);
        ImportDirectoryBuildProps=false;
      </_SharedSourcesPackageProperties>
      <_SharedSourcesPackageProperties Condition=" '$(OverridePackageOutputPath)' != 'false' ">
        $(_SharedSourcesPackageProperties);
        PackageOutputPath=$(BuildDir)
      </_SharedSourcesPackageProperties>
    </PropertyGroup>

    <ItemGroup>
      <_SharedSourceProj Include="$(MSBuildThisFileDirectory)sharedsources.csproj" Condition=" '%(SharedSourceDirectories.Identity)' != '' ">
        <AdditionalProperties>
          $(_SharedSourcesPackageProperties);
          NuspecBasePath=$([MSBuild]::NormalizeDirectory('%(SharedSourceDirectories.Identity)'));
          ProjectDirName=%(SharedSourceDirectories.FileName)%(SharedSourceDirectories.Extension)
        </AdditionalProperties>
      </_SharedSourceProj>
    </ItemGroup>
  </Target>

  <PropertyGroup>
    <IsPackable>true</IsPackable>
    <NoBuild>true</NoBuild>
    <PackageOutputPath Condition="'$(PackageOutputPath)'==''">$(RepositoryRoot)artifacts\build</PackageOutputPath>
    <TargetFramework>netstandard1.0</TargetFramework>
    <EnableDefaultItems>false</EnableDefaultItems>
    <PackageId Condition=" '$(PackageId)' == '' ">$(ProjectDirName)</PackageId>
    <Description>$(PackageId)</Description>
    <IncludeBuildOutput>false</IncludeBuildOutput>
    <IncludeSymbols>false</IncludeSymbols>
    <ContentTargetFolders>contentFiles</ContentTargetFolders>
    <DisableImplicitFrameworkReferences>true</DisableImplicitFrameworkReferences>
    <DefaultExcludeItems>$(DefaultExcludeItems);$(BaseOutputPath);$(BaseIntermediateOutputPath);</DefaultExcludeItems>
    <!-- Suppress warnings about using semver 2.0 versions in packages -->
    <NoWarn>$(NoWarn);NU5105</NoWarn>
  </PropertyGroup>

  <Target Name="VerifyProperties">
    <Error Text="Missing property: RepositoryRoot" Condition="'$(RepositoryRoot)'==''"/>
    <Error Text="Missing property: PackageId" Condition="'$(PackageId)'==''"/>
    <Error Text="Missing property: NuspecBasePath" Condition="'$(NuspecBasePath)'==''" />
  </Target>

  <ItemGroup Condition="'$(NuspecBasePath)'!=''">
    <Compile Include="$(NuspecBasePath)**\*.cs" Exclude="$(DefaultExcludeItems)">
      <Pack>true</Pack>
      <PackagePath>$(ContentTargetFolders)\cs\netstandard1.0\shared\%(RecursiveDir)\</PackagePath>
    </Compile>
    <EmbeddedResource Include="$(NuspecBasePath)**\*.resx" Exclude="$(DefaultExcludeItems)">
      <Pack>true</Pack>
      <PackagePath>$(ContentTargetFolders)\any\any\shared\%(RecursiveDir)\</PackagePath>
    </EmbeddedResource>
  </ItemGroup>

  <ItemGroup>
    <PackageReference Remove="@(PackageReference)" />
  </ItemGroup>
</Project>
